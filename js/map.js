/*
		var map = L.map('mapid').setView([30, -55], 4);

		L.tileLayer('tiles/alisterra/{z}/{x}-{y}.png',{
		minZoom: 3,
		maxZoom: 6,
		attribution: '',
		tms: false
		}).addTo(map);
*/		
		var geo_map = L.tileLayer('tiles/alisterra/{z}/{x}-{y}.png', {
			id: 'mapid',
			minZoom: 3,
			maxZoom: 6			
		});
		var map = L.map('mapid', {
			center: [30, -55],
			zoom: 4,
			layers: [geo_map]
		})
		//map.zoomend();
		/*
		map.addEventListener("resize", function() {
			console.log("Границы карты изменились");
		});
		*/
		map.addEventListener("zoomend", function(e) {
			//console.log("zoom?");
		//console.log("capital_Palzem: "+capital_Palzem.getLatLng());
		//console.log("capital_Horskur: "+capital_Horskur.getLatLng());
		//console.log("capital_Center: "+capital_Center.getLatLng());
		//console.log("capital_Maribis: "+capital_Maribis.getLatLng());
		//console.log("capital_Agadat: "+capital_Agadat.getLatLng());
		//console.log("capital_Uttar: "+capital_Uttar.getLatLng());
		//console.log("coord: "+coord.getLatLng());
		});
		
				
		/* */
		// CAPITALS
		
		var capital_Palzem = L.marker([22, -59]).bindPopup(
					'Столица <a href="http://youknowwho.ru/magic/doku.php/%D0%BC%D0%B8%D1%80:%D0%BF%D0%B0%D0%BB%D1%8C%D0%B7%D0%B5%D0%BC%D0%B8%D1%8F">Пальземии</a>'),
				capital_Horskur = L.marker([26.43, -46.0]).bindPopup('Столица Хорскура'),
				capital_Prantar = L.marker([2.28455, -27.94922]).bindPopup('Столица Прантара'),
				capital_Maribis = L.marker([34.37, -95.8]).bindPopup('Столица Марибиса'),
				capital_Uttar = L.marker([56.30, -71.71]).bindPopup('Столица Уттара'),
				capital_Agadat = L.marker([26.24, -79.44]).bindPopup(
					'Столица <a href="http://youknowwho.ru/magic/doku.php/%D0%BC%D0%B8%D1%80:%D0%B0%D0%B3%D0%B0%D0%B4%D0%B0%D1%82">Агадата</a>'),
				capital_Center = L.marker([35.67, -53.87]).bindPopup('Столица Центральных Земель');
		var coord = L.marker([26.43, -46.0], {draggable: true});
		//	coord.addTo(map);
		coord.addEventListener("moveend ", function(e) {
			console.log("coord: "+coord.getLatLng());
		});
		
		var Capitals = L.layerGroup([
																	capital_Palzem, 
																	capital_Horskur, 
																	capital_Center,
																	capital_Maribis,
																	capital_Agadat,
																	capital_Uttar,
																	capital_Prantar
																]);
		
		function setCountryBorders(){
			var latlngs = [
					[27.44979, -64.16016],
					[27.13737, -57.65625],
					[25.87899, -55.54688],
					[23.64452, -53.87695],
					[21.45307, -51.06445],
					[18.89589, -45.70313],
					[19.41479, -41.4624],
					[18.39623, -41.48438],
					[17.39258, -41.30859],
					[13.15438, -40.60547],
					[8.14624, -41.39648],
					[3.51342, -41.30859],
					[3.95194, -50.18555],
					[4.21494, -58.00781],
					[9.27562, -70.13672],
					[12.89749, -73.56445],
					[15.62304, -72.68555],
					[16.72039, -72.24609],
					[17.97873, -72.50977],
					[19.80805, -71.2793],
					[21.1255, -71.10352],
					[23.80545, -69.78516],
					[25.56227, -68.55469],
					[26.6671, -66.5332]
				];
			var Palzem = L.polygon(latlngs, {color: '#bebebe'}).bindPopup(
				'<a href="http://youknowwho.ru/magic/doku.php/%D0%BC%D0%B8%D1%80:%D0%BF%D0%B0%D0%BB%D1%8C%D0%B7%D0%B5%D0%BC%D0%B8%D1%8F">Пальземия</a>');
			var latlngs = [
					[27.44979, -64.16016],
					[27.13737, -57.65625],
					[25.87899, -55.54688],
					[23.64452, -53.87695],
					[21.45307, -51.06445],
					[18.89589, -45.70313],
					[19.41479, -41.4624],
					[18.39623, -41.48438],
					[17.39258, -41.30859],
					[13.15438, -40.60547],
					[8.14624, -41.39648],
					[5.87833, -40.60547],
					[3.95194, -50.18555],
					[4.21494, -58.00781],
					[9.27562, -70.13672],
					[12.89749, -73.56445],
					[15.62304, -72.68555],
					[16.72039, -72.24609],
					[17.97873, -72.50977],
					[19.80805, -71.2793],
					[21.1255, -71.10352],
					[23.80545, -69.78516],
					[25.56227, -68.55469],
					[26.6671, -66.5332]
				];
			var Shatam = L.polygon(latlngs, {color: '#bebebe'}).bindPopup('Пальземия');
				latlngs = [
						[25.87899, -55.54688],
						[23.64452, -53.87695],
						[21.45307, -51.06445],
						[18.89589, -45.70313],
						[19.41479, -41.4624],
						[18.39623, -41.48438],
						[19.70466, -39.44092],
						[20.77666, -39.11133],
						[21.69827, -39.8584],
						[23.66465, -39.19922],
						[25.28444, -38.69385],
						[27.27416, -38.97949],
						[30.12612, -39.22119],
						[32.32428, -40.40771],
						[34.47034, -40.67139],
						[34.34344, -42.73682],
						[33.6695, -44.01123],
						[32.56533, -46.49414],
						[32.04533, -48.64746],
						[30.90222, -48.66943],
						[29.9359, -49.35059],
						[30.18312, -50.47119],
						[30.48655, -50.93262],
						[30.14513, -51.43799],
						[29.17135, -50.55908],
						[28.49766, -50.64697],
						[28.0138, -52.0752],
						[27.89735, -53.15186],
						[28.32372, -54.82178],
						[27.62514, -55.15137],
						[26.58853, -54.60205]
					];
			var Horskur = L.polygon(latlngs, {color: '#371401'}).bindPopup('Хорскур');
			
				latlngs = [
						[19.70466, -39.44092],
						[20.77666, -39.11133],
						[21.69827, -39.8584],
						[23.66465, -39.19922],
						[25.28444, -38.69385],
						[27.27416, -38.97949],
						[30.12612, -39.22119],
						[32.32428, -40.40771],
						[34.47034, -40.67139],
						[34.07086, -37.74902],
						[35.22767, -33.85986],
						[35.08396, -32.43164],
						[35.67515, -31.48682],
						[34.52466, -31.50879],
						[33.74261, -32.10205],
						[32.84267, -31.97021],
						[30.84565, -32.67334],
						[29.993, -33.06885],
						[29.11378, -33.0249],
						[27.81964, -33.31055],
						[26.52957, -32.69531],
						[24.98606, -33.90381],
						[22.79644, -34.91455],
						[22.02455, -36.43066],
						[20.85881, -38.0127]
					];
			var Shatam = L.polygon(latlngs, {color: '#ff9800'}).bindPopup('Шатам');
			
				latlngs = [
						[18.39623, -41.50635],
						[19.68397, -39.52881],
						[20.83828, -38.05664],
						[22.02455, -36.40869],
						[22.87744, -34.91455],
						[24.92629, -33.92578],
						[26.49024, -32.67334],
						[26.2343, -31.2670],		
						[27.05913, -29.50928],		
						[26.03704, -28.56445],		
						[24.8665, -28.32275],		
						[24.44715, -28.08105],		
						[24.14675, -24.80713],		
						[22.77618, -21.88477],		
						[21.14599, -16.52344],		
						[21.0845, -15.40283],		
						[20.36523, -15.31494],		
						[20.28281, -14.17236],		
						[19.29041, -15.00732],			
						[18.43792, -15.29297],			
						[17.16179, -14.74365],			
						[16.74143, -14.89746],			
						[16.19357, -14.47998],			
						[13.19716, -14.26025],			
						[10.98434, -15.05127],			
						[10.27168, -18.17139],			
						[12.94032, -24.98291],		
						[13.49647, -28.30078],	
						[12.76895, -31.00342],	
						[13.09018, -32.65137],	
						[13.13298, -40.5835]
					];
			var Baronstva = L.polygon(latlngs, {color: '#3f51b5'}).bindPopup(
				'<a href="http://youknowwho.ru/magic/doku.php/%D0%BC%D0%B8%D1%80:%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%B1%D0%B0%D1%80%D0%BE%D0%BD%D1%81%D1%82%D0%B2%D0%B0">Вольные Баронства</a>');
			
				latlngs = [			
						[10.27168, -18.17139],			
						[12.94032, -24.98291],		
						[13.49647, -28.30078],	
						[12.76895, -31.00342],	
						[13.09018, -32.65137],	
						[13.13298, -40.5835],
						[8.18974, -41.2207],
						[5.83462, -40.56152],					
						[3.95194, -40.78125],
						[1.5379, -40.56152],
						[-0.30762, -40.7373],
						[-0.04395, -13.75488],
						[0.87887, -15.60059],
						[2.32846, -16.47949],
						[4.25877, -16.43555],
						[6.44632, -17.3584],
						[7.44962, -18.3252],
						[7.58033, -19.59961],
						[8.88507, -18.36914],
						[9.75237, -17.62207]
					];
			var Prantar = L.polygon(latlngs, {color: '#ffeb3b'}).bindPopup('Прантар');
			
				latlngs = [			
						[34.52466, -40.69336],
						[34.07086, -37.74902],
						[35.20972, -33.90381],
						[35.13788, -32.49756],
						[35.67515, -31.39893],
						[35.012, -30.52002],
						[33.85217, -29.79492],
						[33.68778, -27.90527],
						[33.61462, -22.58789],
						[35.67515, -15.64453],
						[40.38003, -10.81055],
						[47.12995, -12.39258],
						[48.34165, -15.77637],
						[47.30903, -18.1054],
						[47.57653, -24.3457],
						[48.25394, -28.47656],
						[47.54687, -29.5312],
						[45.39845, -28.74023],
						[44.77794, -30.0585],
						[46.28622, -33.1347],
						[42.35854, -37.08984],
						[37.05518, -40.78125]
					];
			var Bolota = L.polygon(latlngs, {color: '#025e48'}).bindPopup('Великие Болота');
			
				latlngs = [			
						[37.50973, -40.64941],	
						[39.63954, -44.0332],	
						[40.74726, -47.90039],	
						[42.45589, -47.72461],	
						[43.42101, -48.82324],	
						[44.21371, -47.19727],	
						[43.83453, -46.3623],	
						[45.70618, -45.35156],	
						[47.42809, -46.05469],	
						[50.03597, -43.94531],	
						[50.1769, -40.7373],	
						[49.92294, -35.1123],	
						[46.31658, -33.3544]
					];
			var OuterGnome = L.polygon(latlngs, {color: '#472f05'}).bindPopup('Гномы-отшельники');
			
				latlngs = [			
						[39.26628, -52.86621],
						[41.44273, -53.96484],
						[41.50858, -55.06348],
						[42.87596, -55.01953],
						[43.58039, -58.00781],
						[43.42101, -59.5459],
						[44.71551, -60.33691],
						[45.85941, -60.77637],
						[47.36859, -57.78809],
						[51.31688, -54.71191],
						[51.28941, -49.74609],
						[48.63291, -47.98828],
						[47.27923, -46.2304],
						[45.4293, -45.83496],
						[44.21371, -46.53809],
						[44.40239, -47.41699],
						[43.70759, -49.13086],
						[42.45589, -48.7793],
						[42.06561, -48.07617],
						[40.58058, -48.33984],
						[40.58058, -49.35059],
						[41.34382, -49.74609],
						[41.17865, -50.625],
						[40.24599, -50.71289],
						[39.63954, -52.38281]
					];
			var DarkElf = L.polygon(latlngs, {color: '#9c27b0'}).bindPopup('Тенеречье');
			
				latlngs = [			
					[33.02709, -65.87402],
					[34.88593, -67.14844],
					[37.78808, -65.91797],
					[41.37681, -61.61133],
					[42.39101, -62.8418],
					[44.1822, -65.1709],
					[44.77794, -62.79785],
					[45.52174, -61.12793],
					[43.67582, -60.64453],
					[42.90816, -59.41406],
					[43.2292, -57.83203],
					[42.58544, -55.59082],
					[41.01307, -55.7666],
					[41.01307, -54.58008],
					[38.89103, -52.954],
					[40.01079, -50.31738],
					[40.91351, -50.05371],
					[40.14529, -49.21875],
					[40.31304, -48.03223],
					[39.3343, -43.9453],
					[37.26531, -41.0009],
					[34.56086, -40.91309],
					[34.41597, -42.75879],
					[32.28713, -48.47168],
					[32.80574, -50.49316],
					[33.83392, -50.49316],
					[34.66936, -53.56934],
					[34.59704, -55.63477],
					[35.06597, -56.86523],
					[34.74161, -58.05176],
					[35.71084, -59.67773],
					[35.31737, -62.49023],
					[34.48845, -63.54492],
					[34.30714, -65.03906],
					[32.54681, -65.56641]
					];
			var Center = L.polygon(latlngs, {color: '#ffeb3b'}).bindPopup('Центральные Земли');
			
				latlngs = [			
					[43.92955, -65.43457],
					[41.32733, -61.89697],
					[37.8228, -66.20361],
					[34.83184, -67.43408],
					[32.2128, -65.6543],
					[30.05008, -67.36816],
					[30.20211, -76.4209],
					[29.80252, -82.63916],
					[34.52466, -83.36426],
					[37.26531, -83.03467],
					[38.11727, -80.31006],
					[40.94671, -82.96875],
					[41.7877, -78.61816],
					[41.95132, -71.25732],
					[42.89206, -66.66504]
					];
			var Elf = L.polygon(latlngs, {color: '#8bc34a'}).bindPopup('Эльфы');
			
				latlngs = [			
					[29.36303, -82.48535],	
					[29.82158, -76.50879],	
					[29.63077, -67.30225],	
					[27.07869, -68.88428],	
					[25.50278, -69.104],	
					[23.3019, -71.16943],	
					[17.97873, -73.14697],	
					[15.00846, -73.95996],	
					[12.29707, -76.15723],	
					[10.87646, -81.40869],	
					[11.45849, -87.34131],
					[12.29707, -88.1543],	
					[11.86735, -89.20898],
					[12.68321, -90.7470],	
					[13.06878, -90.79102],
					[13.23995, -91.66992],
					[14.22179, -91.9555],
					[14.39212, -92.52686],
					[15.49603, -92.5048],
					[15.24179, -91.4721],
					[14.66863, -91.56006],
					[14.47723, -90.52734],
					[14.09396, -90.54932],
					[14.30697, -90.06592],
					[13.79541, -89.2749],
					[13.71004, -88.28613],
					[13.5392, -87.97852],
					[13.94473, -84.52881],
					[15.89794, -82.26563],
					[17.07779, -79.07959],
					[18.83352, -78.04688],
					[20.28281, -79.233],
					[19.994, -80.90332],
					[21.22794, -82.66113],
					[20.32402, -84.06738],
					[20.05593, -85.86914],
					[21.35078, -88.43994],
					[23.44309, -88.50586],
					[24.48715, -86.50635],
					[25.32417, -86.77002],
					[26.74561, -84.30908],
					[28.34306, -84.17725]
					];
			var Agadat = L.polygon(latlngs, {color: '#f44336'}).bindPopup(
				'<a href="http://youknowwho.ru/magic/doku.php/%D0%BC%D0%B8%D1%80:%D0%B0%D0%B3%D0%B0%D0%B4%D0%B0%D1%82">Агадат</a>');
			
				latlngs = [			
					[30.12612, -82.94678],	
					[34.54276, -83.54004],	
					[37.42253, -83.05664],	
					[37.38762, -86.06689],	
					[36.96745, -87.56104],	
					[37.52715, -88.33008],	
					[37.31775, -90.30762],	
					[38.80547, -90.21973],	
					[38.46219, -91.73584],	
					[38.11727, -91.71387],	
					[37.31775, -92.24121],	
					[37.03764, -92.04346],	
					[36.63316, -92.24121],	
					[36.70366, -93.07617],	
					[36.52729, -94.87793],	
					[34.83184, -96.1084],	
					[33.54139, -96.37207],	
					[31.25977, -95.1416],	
					[30.619, -92.54883],
					[30.97761, -89.62646],
					[29.97397, -87.29736],
					[30.06909, -85.18799],
					[29.36303, -84.70459]
					];
			var Atlant = L.polygon(latlngs, {color: '#00bcd4'}).bindPopup('Аланты');
			
				latlngs = [			
					[44.02442, -65.43457],	
					[43.00465, -67.06055],	
					[42.26105, -71.2793],	
					[42.00033, -78.70605],	
					[41.04622, -83.36426],	
					[40.61395, -84.55078],	
					[42.06561, -89.64844],	
					[43.61222, -90.70312],	
					[46.28622, -91.05469],	
					[48.37085, -91.05469],	
					[49.63918, -91.80176],	
					[50.48547, -94.79004],
					[52.34876, -95.88867],
					[54.16243, -97.11914],
					[55.89996, -101.60156],
					[58.60833, -99.62402],
					[59.80063, -98.96484],
					[60.56538, -93.12012],
					[60.58697, -54.53613],
					[54.74999, -53.48145],
					[53.06763, -54.44824],
					[51.39921, -54.8877],
					[47.54687, -57.96387],
					[44.99588, -63.28125]
					];
			var North = L.polygon(latlngs, {color: '#64a8dd'}).bindPopup('Уттар');
			
			return L.layerGroup([
																				Palzem,
																				Horskur,
																				Shatam,
																				Baronstva,
																				Prantar,
																				Bolota,
																				OuterGnome,
																				DarkElf,
																				Center,
																				Elf,
																				Agadat,
																				Atlant,
																				North
																			]);
		}
		
		var countryBorders = setCountryBorders();
		
		
		var baseMaps = {
			"География": geo_map
		};

		var overlayMaps = {
				"Границы стран": countryBorders,
				"Столицы": Capitals
		};
		
		///
		var town_Narta = L.marker([12.66178, -40.56152]).bindPopup(
					'Нарта'),
				city_BykovBrod = L.marker([15.83454, -41.68213]).bindPopup(
					'Быков Брод'),
					village_Bobrovka = L.marker([12.91891, -41.33057]).bindPopup(
					'деревня Бобровка'),
					village_Holmovka = L.marker([13.88075, -41.35254]).bindPopup(
					'деревня лесорубов Холмовка');
		var citi = L.layerGroup([
															town_Narta, 
															city_BykovBrod, 
															village_Bobrovka,
															village_Holmovka
														]);
		var org_Heroes = L.marker([24.78673, -29.59717]).bindPopup(
					'Гильдия героев'),
				org_MagicInstittute = L.marker([35.51434, -53.63525]).bindPopup(
					'Университет магии'),
				org_Hodoki = L.marker([38.75408, -32.87109]).bindPopup(
					'Вольные Ходоки'),
				org_SobirateliZnaniy = L.marker([35.46067, -32.69531]).bindPopup(
					'Собиратели знаний'),
				org_OrdenBezyzvestnyh = L.marker([17.97873, -58.71094]).bindPopup(
					'Орден безызвестных'),
				org_KrugVedm = L.marker([16.76247, -55.41504]).bindPopup(
					'Круг Ведьм');
		var orgs = L.layerGroup([
															org_Heroes, 
															org_MagicInstittute, 
															org_Hodoki,
															org_SobirateliZnaniy,
															org_OrdenBezyzvestnyh,
															org_KrugVedm
														]);
		///
		
		var lControl = L.control.layers(baseMaps, overlayMaps, {hideSingleBase: true});
				lControl.addTo(map);
		if(String(window.location.hash)=="#DM"){
			console.log("Are you really DM? (￢_￢)");
			lControl.addOverlay(citi, "Города");
			lControl.addOverlay(orgs, "Организации");
		}
		
		
		
		
		/**/